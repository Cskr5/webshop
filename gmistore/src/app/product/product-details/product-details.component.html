<div class="containerX" fxLayoutAlign="center">
  <mat-card class="mat-elevation-z8" fxLayout="row wrap" fxLayoutGap="10px"
            fxFlex.lt-md="100" fxFlex.gt-md="70" fxLayoutAlign="space-between" *ngIf="product">

    <div fxFlex="40" fxFlex.xs="100" fxFlex.gt-xs="48" fxLayout="column" fxLayoutAlign="start"
         fxLayoutGap="15px">

      <div fxFlex="100">
        <img [src]="defaultPicture" fxFlexFill alt="main-image"/>
      </div>

      <div class="thumbnail-pictures-div" fxFlex="100" fxLayout="row" fxLayoutAlign="space-evenly center">
        <div *ngFor="let picture of product.pictures" class="preview-thumbnail" fxFlex="30">
          <img mat-card-image class="preview-image" [src]="picture" (click)="changeDefaultImg(picture)"
               alt="Thumbnail picture"/>
        </div>
      </div>

    </div>

    <div fxFlex="40" fxFlex.xs="100" fxFlex.gt-xs="48" fxLayout="column" fxLayoutAlign="stretch start">
      <div fxFlex="100">
        <mat-card-title>{{product.name}}</mat-card-title>
        <mat-card-subtitle>Vásárlói vélemények: {{product.ratings.length}}</mat-card-subtitle>

        <div class="rating">
          <div class="star-ratings-css">
            <div class="star-ratings-css-top" [ngStyle]="{'max-width.px': averageRatingPercentage}">
              <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
            </div>
            <div class="star-ratings-css-bottom">
              <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
            </div>
          </div>
        </div>

        <mat-card-content>
          <p>Termék azonosító: {{product.productCode}}</p>
          <p>Kategória: {{product.category}}</p>
          <p>{{product.warrantyMonths}} hónap garancia</p>
          <p>{{product.quantitySold}} eladott darab</p>
        </mat-card-content>
      </div>


      <div class="" *ngIf="product.quantityAvailable > 0" fxFlex="100" fxLayout="column">

        <span class="spacer"></span>
        <mat-card-subtitle>Kiszállítás: akár 1 munkanapon belül</mat-card-subtitle>
        <mat-card-content>{{product.quantityAvailable}} raktáron</mat-card-content>

        <mat-card-header *ngIf="product.discount == 0">
          <mat-card-content>
            {{product.price  | currency : 'HUF' : 'symbol-narrow' : '3.0' }}
          </mat-card-content>
        </mat-card-header>

        <mat-card-header *ngIf="product.discount > 0">
          <mat-card-title class="discounted-price">
            {{calculateDiscountedPrice() | currency :'HUF' : 'symbol-narrow' : '3.0' }}
          </mat-card-title>
          <mat-card-subtitle>
            <del>
              {{product.price  | currency : 'HUF' : 'symbol-narrow' : '3.0' }}
            </del>
            ({{ product.discount }} % )
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-actions fxLayoutAlign="bottom start">
          <button mat-button [color]="'primary'" type="button" (click)="addToCart(product.id)">
            <mat-icon>add_shopping_cart</mat-icon>
            Kosárba
          </button>
          <button mat-button [color]="'primary'" type="button">
            <mat-icon>favorite</mat-icon>
            Kedvencekhez
          </button>
        </mat-card-actions>
      </div>

      <div fxLayout="column" fxFlex="100" *ngIf="product.quantityAvailable == 0" fxLayoutAlign="bottom start">
        <span class="spacer"></span>
        <mat-card-title>Nincs raktáron</mat-card-title>
        <button mat-button [color]="'primary'" type="button">
          <mat-icon>favorite</mat-icon>
          Kedvencekhez
        </button>
      </div>
    </div>

    <mat-divider class="divider-accent-colored" inset="true"></mat-divider>

    <div class="mt-15" fxFlex="100">
      <mat-card-header>
        <mat-icon mat-card-avatar>description</mat-icon>
        <mat-card-title>
          Leírás:
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        {{product?.description}}
      </mat-card-content>
    </div>

    <mat-divider class="divider-accent-colored" inset="true"></mat-divider>

    <div class="mt-15" fxFlex="100" fxLayout="row wrap">

      <mat-card-header fxFlex="100">
        <mat-icon mat-card-avatar>grade</mat-icon>
        <mat-card-title>Vélemények & értékelések</mat-card-title>
      </mat-card-header>

      <mat-card-subtitle *ngIf="!authenticatedUser">Jelentkezz be értékeléshez.</mat-card-subtitle>

      <div fxFlex="45">
        <div fxLayout="row wrap">
          <mat-card-title fxFlex="30"><strong>{{ currentRating }}</strong> / 5</mat-card-title>

          <div class="rating" fxFlex="65">
            <div class="star-ratings-css">
              <div class="star-ratings-css-top" [ngStyle]="{'max-width.px': averageRatingPercentage}">
                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
              </div>
              <div class="star-ratings-css-bottom">
                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
              </div>
            </div>
          </div>

          <mat-card-subtitle fxFlex="30">{{ ratings?.length }} értékelés</mat-card-subtitle>
        </div>
      </div>

      <div fxFlex="55" fxFlex.lt-sm="100" fxLayout="column">

        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
          <p fxFlex="12" class="rating-bar-text">5 csillag</p>
          <mat-progress-bar [value]="fiveStarPercentage" matTooltip="{{ fiveStarPercentage }} %" fxFlex="80">
          </mat-progress-bar>
          <p fxFlex="5" class="rating-bar-text">{{ fiveStars }}</p>
        </div>

        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
          <p fxFlex="12" class="rating-bar-text">4 csillag</p>
          <mat-progress-bar [value]="fourStarPercentage" matTooltip="{{ fourStarPercentage }} %" fxFlex="80">
          </mat-progress-bar>
          <p fxFlex="5" class="rating-bar-text">{{ fourStars }}</p>
        </div>

        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
          <p fxFlex="12" class="rating-bar-text">3 csillag</p>
          <mat-progress-bar [value]="threeStarPercentage" matTooltip="{{ threeStarPercentage }} %" fxFlex="80">
          </mat-progress-bar>
          <p fxFlex="5" class="rating-bar-text">{{ threeStars }}</p>
        </div>

        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
          <p fxFlex="12" class="rating-bar-text">2 csillag</p>
          <mat-progress-bar [value]="twoStarPercentage" matTooltip="{{ twoStarPercentage }} %" fxFlex="80">
          </mat-progress-bar>
          <p fxFlex="5" class="rating-bar-text">{{ twoStars }}</p>
        </div>

        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between center">
          <p fxFlex="12" class="rating-bar-text">1 csillag</p>
          <mat-progress-bar [value]="oneStarPercentage" matTooltip="{{ oneStarPercentage }} %" fxFlex="80">
          </mat-progress-bar>
          <p fxFlex="5" class="rating-bar-text">{{ oneStar }}</p>
        </div>

      </div>
    </div>

    <div class="mt-15" fxFlex="100" fxLayout="column" fxLayoutGap="15px">
      <div *ngFor="let rating of ratings" fxFlex="100" fxLayout="row wrap" fxLayoutAlign="space-between">

        <mat-divider inset="true" class="divider-accent-colored"></mat-divider>

        <div class="mt-15" fxFlex="30" fxFlex.lt-md="100">
          <mat-card-header>
            <mat-icon mat-card-avatar>history</mat-icon>
            <mat-card-subtitle>{{ rating.timeStamp | date: "yyyy-MM-dd" }}</mat-card-subtitle>
            <mat-card-subtitle>{{ rating.username }}</mat-card-subtitle>
          </mat-card-header>

        </div>

        <div class="mt-15" fxFlex="65" fxFlex.lt-md="100" fxLayout="column">

          <div class="rating pl-2 mt-1">
            <div class="star-ratings-css">
              <div class="star-ratings-css-top"
                   [ngStyle]="{'max-width.px': calculatePercentageForRating(rating.actualRating)}">
                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
              </div>
              <div class="star-ratings-css-bottom">
                <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
              </div>
            </div>
          </div>

          <mat-card-content>{{ rating.comment }}</mat-card-content>

        </div>
      </div>
    </div>

  </mat-card>
</div>
